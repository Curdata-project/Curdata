# RFC0006 数字货币发行系统

## 设计原理

数字货币登记系统是DCEP中负责进行钱包管理的重要子系统，本部分包括具体的用于对数字货币转移进行确认，用于生成新的数字货币，并进行签名的功能，同时包括对数字货币进行签名的操作API定义。本部分是对DCEP设计中数字货币登记系统的实现框架与模拟。

## 具体设计

具体数字货币登记系统的设计包含三部分：数字货币定义，数字货币所有权验证流程与系统相关API

### 数字货币定义

DCEP中的数字货币核心字段存在三部分，分别是额度控制位（`Quota Control Digital`），数字货币所有者身份标识（`Owner Identity`），数字货币签名（`Digital Currency Signature`）。其中数字货币所有者身份标识需要能够认证用户的身份，数字货币签名则需要数字货币登记系统对前两部分进行签名。


#### 数字货币（DigitalCurrency）

pub struct DigitalCurrency {
    /// 数字货币额度控制位，由额度控制位附加上发行机构证书，签名组成
    quota_info: QuotaWrapper,
    /// 钱包公钥
    wallet_cert: CertificateSm2,
}

### 数字货币交易格式

用户可以对自己手中所拥有的数字货币进行签名，实现数字货币的所有权转换。具体的交易由多个KV对象组成，每一个KV对象可以表示为如下：

```json
{
    "coin": "", // Base64过的具体的货币
    "target": "", // 货币接收者的身份标识
    "receive": "", // 接收货币的交易信息
}
```

### 数字货币交易进行流程

1. 验证KV对象的正确性
2. 验证货币接收者信息的正确性
3. 验证接收货币的交易信息正确（可选）
4. 从货币中读取额度控制位
5. 将货币接收者的身份标识与额度控制位拼接，生成新的数字货币
6. 对新的数字货币进行数字签名

### 数字货币生成流程

数字货币的生成流程，区别在于需要通过内部系统生成额度控制位，而不是从数字货币中读取。

### API设计

#### 自有证书管理

同额度控制系统

#### 进行交易

HTTP 请求：`POST /api/public/transaction`

请求示例：

```json
{
    "transaction": "", // Base64处理过的交易体
}
```

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
    	"receipt": "", // 交易回执
        "coin": "" , //生成的新货币
    }
}
```

#### 生成数字货币

HTTP 请求：`POST /api/internal/meta`

请求示例：

```json
{
    "quota", // Base64过的额度控制位
    "target": "", // 货币接收者的身份标识
    "receive": "", // 接收货币的交易信息
}
```

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
    	"return": "", // 交易回执
        "coin": "" , //生成的新货币
    }
}
```

## 需增加部分

- 提供离线交易的交易格式支持
- 增加额度控制位管理系统（银行端）

### 