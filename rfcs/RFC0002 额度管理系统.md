# RFC0004 额度管理系统

## 设计原理

额度管理系统是DCEP中负责进行额度管理的重要子系统，本部分包括具体的额度控制位定义与额度管理系统的操作API定义。本部分是对DCEP设计中额度管理系统的实现框架与模拟。

## 具体设计

具体额度管理系统的设计包含两部分：额度控制位与额度控制系统设计

### 额度控制位定义

额度控制位的定义需要借助于KV对象进行定义，具体定义为如下的形式：

```json
{
    "id": "", // 类型为字符串，每一个额度控制位都拥有唯一的ID字符串
    "amount": 0, // 金额，描述此额度控制位的金额，u64，乘以10^8。
    "timestamp": 0, // 发行者时间戳
    "req": "", // 交易请求，关联到额度控制位的发行请求。
}
```

### 额度控制系统

额度控制系统负责管理与生成额度控制位，可以按照需求生成与管理具体的额度控制。

#### 额度控制位映射表

额度控制系统的核心是一个额度控制位映射表，其中记录了如下信息（其中的描述参考SQL设计）：

| 字段名     | 字段类型        | 字段解释                       |
| ---------- | --------------- | ------------------------------ |
| ID         | VARCHAR(256)    | 记录额度控制位的ID             |
| 金额       | unsigned int 64 | 记录额度控制位的金额           |
| 发行时间   | timestamp       | 额度控制位的发行时间           |
| 交易请求ID | VARCHAR(256)    | 额度控制位相关联的交易请求     |
| 额度控制位 | string          | 额度控制位字符串，以base64存储 |

#### 额度控制元信息

记录了额度控制系统相关的信息，记录了额度控制位相关的信息：

```json
{
    "public": "", // 公钥信息
    "secret": "", // 私钥信息
    "code": "", // 随机码
    "seed": "", // 种子
}
```

额度控制元信息用于额度控制系统发行额度控制位时，对额度控制位进行签名管理。

额度控制元信息可以用于生成公钥证书，具体的公钥证书生成格式遵循X.509格式。额度控制系统证书可以对数字货币登记系统的证书，与数字货币个人信息登记系统的公钥进行签名，形成证书链，实现对用户签名交易信息的链式验证与数字货币本身进行链式验证。

### API设计

#### 创建额度控制元信息

HTTP 请求：`POST /api/admin/meta`

请求示例：

```json
{}
```

响应示例：

```json
{
    "code": 0,
    "message": "success"
}
```

#### 更新额度控制元信息

HTTP 请求：`PUT /api/admin/meta`

请求示例：

```json
{
	"seed": "" // 种子
}
```

响应示例：

```json
{
    "code": 0,
    "message": "success"
}
```

#### 读取额度控制元信息

HTTP 请求：`GET /api/admin/meta`

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "public": "", // 公钥信息
        "secret": "", // 私钥信息
        "code": "", // 随机码
        "seed": "", // 种子
    }
}
```

#### 根据额度控制位ID获取额度控制位

HTTP 请求：`GET /api/quota`

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": "" // 额度控制位Base64编码
}
```

#### 生成额度控制位

HTTP 请求：`POST /api/quota`

请求示例：

```json
[
    {
        "count": 1, // 生成123个
        "amount": 800000000 // 8元
    },
    {
        "count": 2, // 生成123个
        "amount": 900000000 // 9元
    },
]
```

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": [
        "0x00001", // 额度控制位ID
        "0x00002",
        "0x00003"
    ]
}
```

#### 销毁额度控制位

HTTP 请求：`DELETE /api/quota`

请求示例：

```json
[
    "", // 额度控制位Base64表示
    "",
    ""
]
```

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": [
        "0x00001", // 额度控制位ID
        "0x00002",
        "0x00003"
    ]
}
```

## 需增加部分

- 需要增加额度兑换接口及算法